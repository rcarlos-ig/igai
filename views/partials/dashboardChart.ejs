<script type="text/javascript">
  window.onload = function () {
    const ctx = document.getElementById("dashboardChart");

    const labels = "<%= chartLabels %>";
    const data = "<%= chartData %>";

    function soma () {
      const values = data.split(",");
      let subtotal = 0;
      values.forEach(value => {
        subtotal += Number(value);
      });
      return subtotal;
    };

    const percentage = (tooltipItems) => {
      let percentage = 0;

      tooltipItems.forEach(function (tooltipItem) {
        percentage = Number(tooltipItem.formattedValue) / soma();
      });

      return percentage.toLocaleString("default", {
        style: "percent",
        maximumFractionDigits: 1,
      });
    };

    Chart.defaults.font.family = "'Jost', sans-serif";
    Chart.defaults.font.size = 16;
    Chart.defaults.font.lineHeight = 1.25;
    Chart.defaults.color = "rgb(16, 21, 25)";

    const html = document.getElementById("html");
    if (html.classList.contains("dark"))
      Chart.defaults.color = "rgb(249, 250, 251)";

    const chart = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: labels.split(","),
        datasets: [
          {
            label: "Avaliações por tipo",
            data: data.split(","),
            backgroundColor: [
              "rgb(149, 195, 252)",
              "rgb(78, 155, 250)",
              "rgb(8, 116, 247)",
              "rgb(5, 82, 177)",
              "rgb(3, 49, 106)",
              "rgba(185, 28, 28, 1)",
            ],
            hoverOffset: 20,
          },
        ],
      },
      options: {
        layout: {
          padding: 15,
        },
        interaction: {
          mode: "index",
        },
        plugins: {
          legend: {
            position: "bottom",
            labels: {
              font: {
                weight: 600,
              },
            },
          },
          tooltip: {
            callbacks: {
              footer: percentage,
            },
          },
        },
        events: ["mousemove", "mouseout", "touchstart", "touchmove"],
        aspectRatio: 1,
      },
    });
  };

  // window.scrollTo(0,0);
</script>
